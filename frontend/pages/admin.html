<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Canteen â€“ Admin</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body class="admin-page">

  <div class="navbar">
    <h2>ğŸ½ï¸ Admin Dashboard</h2>
    <span>Smart Canteen</span>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <div class="orders-container">
    <h3 style="margin-bottom:20px; color:#1e293b;">ğŸ“‹ Incoming Orders</h3>
    <div id="ordersList"></div>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem('user'));
    if (!user || user.role !== 'admin') window.location.href = 'index.html';

    function logout() {
      localStorage.clear();
      window.location.href = 'index.html';
    }

    async function loadOrders() {
      const res = await fetch('http://localhost:3000/api/orders/all');
      const orders = await res.json();

      if (orders.length === 0) {
        document.getElementById('ordersList').innerHTML = '<p>No orders yet!</p>';
        return;
      }

      let html = '';
      orders.forEach(order => {
        const items = order.items.map(i => `${i.name} x${i.quantity}`).join(', ');
        html += `
          <div class="order-card">
            <h4>Order #${order._id.slice(-6).toUpperCase()}</h4>
            <p>ğŸ´ Items: ${items}</p>
            <p>ğŸ’° Total: â‚¹${order.totalPrice}</p>
            <p>ğŸ• Time: ${new Date(order.createdAt).toLocaleTimeString()}</p>
            <span class="status-badge status-${order.status}">${order.status.toUpperCase()}</span><br/>
            <select class="status-select" onchange="updateStatus('${order._id}', this.value)">
              <option value="pending" ${order.status==='pending'?'selected':''}>Pending</option>
              <option value="preparing" ${order.status==='preparing'?'selected':''}>Preparing</option>
              <option value="ready" ${order.status==='ready'?'selected':''}>Ready</option>
              <option value="completed" ${order.status==='completed'?'selected':''}>Completed</option>
            </select>
          </div>`;
      });

      document.getElementById('ordersList').innerHTML = html;
    }

    async function updateStatus(orderId, status) {
      await fetch(`http://localhost:3000/api/orders/status/${orderId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status })
      });
      loadOrders();
    }

    loadOrders();
    setInterval(loadOrders, 10000);
  </script>

</body>
</html>